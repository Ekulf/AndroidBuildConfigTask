Based off code from the android sdk.

https://android.googlesource.com/platform/sdk
